---
title: '[TensorFlow 2.0] Optimizer 및 Training (Keras)'
categories:
  - Programming
  - AI
tags:
  - AI
  - Tensorflow
date: 2020-07-24 17:35:22
thumbnail:
---

## Optimization & Training

### Load Packages

```python
import tensorflow as tf
from tensorflow.keras import layers

from tensorflow.keras import datasets
```

### 학슴 과정 돌아보기

![](/images/ai/dev/18.png)

### Prepare MNIST Datset

```python
(train_x, train_y), (test_x, test_y) = datasets.mnist.load_data()
```

### Build Model

```python
inputs = layers.Input((28, 28, 1))
net = layers.Conv2D(32, (3, 3), padding='SAME')(inputs)
net = layers.Activation('relu')(net)
net = layers.Conv2D(32, (3, 3), padding='SAME')(net)
net = layers.Activation('relu')(net)
net = layers.MaxPooling2D(pool_size=(2, 2))(net)
net = layers.Dropout(0.25)(net)

net = layers.Conv2D(64, (3, 3), padding='SAME')(net)
net = layers.Activation('relu')(net)
net = layers.Conv2D(64, (3, 3), padding='SAME')(net)
net = layers.Activation('relu')(net)
net = layers.MaxPooling2D(pool_size=(2, 2))(net)
net = layers.Dropout(0.25)(net)

net = layers.Flatten()(net)
net = layers.Dense(512)(net)
net = layers.Activation('relu')(net)
net = layers.Dropout(0.5)(net)
net = layers.Dense(10)(net)  # num_classes
net = layers.Activation('softmax')(net)

model = tf.keras.Model(inputs=inputs, outputs=net, name='Basic_CNN')
```

### Optimization

모델을 학습하기 전에 설정을 한다.

- Loss Function
- Optimization
- Metrics

### Loss Function

#### Categorical vs Binary

```python
loss = 'binary_crossentropy'
loss = 'categorical_crossentropy'
```

#### sparse_categorical_crossentropy vs categorical_crossentropy

```python
loss_fun = tf.keras.losses.sparse_categorical_crossentropy

# 또는
tf.keras.losses.categorical_crossentropy
tf.keras.losses.binary_crossentropy
```

### Metrics

모델을 평가하는 방법이다.

```python
# accurany를 이름으로 넣는 방법
metrics = ['accuracy']

# tf.keras.metrics
metrics = [tf.keras.metrics.Accuracy()]
```

### Optimizer

- 'sgd'
- 'rmsprop'
- 'adam'

```python
optm = tf.keras.optimizers.Adam()

# Out
tf.keras.optimizers.SGD()
tf.keras.optimizers.RMSprop()
tf.keras.optimizers.Adam()
```

### Compile

Optimizer 적용을 한다.

```python
model.compile(optimizer=tf.keras.optimizers.Adam(),
              loss='sparse_categorical_crossentropy',
              metrics=[tf.keras.metrics.Accuracy()])
```

### Prepaer Dataset

학습에 사용할 데이터셋을 준비한다.

데이터셋 확인

```python
train_x.shape, train_y.shape
> ((60000, 28, 28), (60000,))

test_x.shape, test_y.shape
> ((10000, 28, 28), (10000,))
```

차원 수 늘리기

:art:

```python
import numpy as np

np.expand_dims(train_x, -1).shape
> (60000, 28, 28, 1)

tf.expand_dims(train_x, -1).shape
> TensorShape([60000, 28, 28, 1])
```

```python
train_x = train_x[..., tf.newaxis]
test_x = test_x[..., tf.newaxis]
```
